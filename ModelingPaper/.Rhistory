geom_sf(aes(fill = mean_plant), color = NA) +
scale_fill_viridis(limits = c(60, 120)) +
ggtitle(paste('mean plant, all years', intensity, percentile)) +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black",
alpha = 0, linetype = 1) +
theme_bw()
print(mean_plant_plot)
intensity <- 'SC'
percentile <- 'percentile25'
onset_oi_data_subset <- onset_oi_data[onset_oi_data$intensity == intensity & onset_oi_data$plant_stat_type == percentile,]
# spatial join each year's data to calculate the mean planting date
onset_oi_data_2004 <- onset_oi_data_subset[onset_oi_data_subset$year == 2004,]
onset_oi_data_2005 <- onset_oi_data_subset[onset_oi_data_subset$year == 2005,]
onset_oi_data_2006 <- onset_oi_data_subset[onset_oi_data_subset$year == 2006,]
onset_oi_data_2007 <- onset_oi_data_subset[onset_oi_data_subset$year == 2007,]
onset_oi_data_2008 <- onset_oi_data_subset[onset_oi_data_subset$year == 2008,]
onset_oi_data_2009 <- onset_oi_data_subset[onset_oi_data_subset$year == 2009,]
onset_oi_data_2010 <- onset_oi_data_subset[onset_oi_data_subset$year == 2010,]
onset_oi_data_2011 <- onset_oi_data_subset[onset_oi_data_subset$year == 2011,]
onset_oi_data_2012 <- onset_oi_data_subset[onset_oi_data_subset$year == 2012,]
onset_oi_data_2013 <- onset_oi_data_subset[onset_oi_data_subset$year == 2013,]
onset_oi_data_2014 <- onset_oi_data_subset[onset_oi_data_subset$year == 2014,]
joined_2years <- st_join(onset_oi_data_2004, onset_oi_data_2005, largest = TRUE, suffix = c('_2004', '_2005'))
joined_2years <- joined_2years[,c('plant_2004', 'plant_2005')]
joined_3years <- st_join(joined_2years, onset_oi_data_2006, largest = TRUE)
joined_3years['plant_2006'] <- joined_3years['plant']
joined_3years <- joined_3years[,c('plant_2004', 'plant_2005', 'plant_2006')]
joined_4years <- st_join(joined_3years, onset_oi_data_2007, largest = TRUE)
joined_4years['plant_2007'] <- joined_4years['plant']
joined_4years <- joined_4years[,c('plant_2004', 'plant_2005', 'plant_2006', 'plant_2007')]
joined_5years <- st_join(joined_4years, onset_oi_data_2008, largest = TRUE)
joined_5years['plant_2008'] <- joined_5years['plant']
joined_5years <- joined_5years[,c('plant_2004', 'plant_2005', 'plant_2006', 'plant_2007', 'plant_2008')]
joined_6years <- st_join(joined_5years, onset_oi_data_2009, largest = TRUE)
joined_6years['plant_2009'] <- joined_6years['plant']
joined_6years <- joined_6years[,c('plant_2004', 'plant_2005', 'plant_2006', 'plant_2007', 'plant_2008', 'plant_2009')]
joined_7years <- st_join(joined_6years, onset_oi_data_2010, largest = TRUE)
joined_7years['plant_2010'] <- joined_7years['plant']
joined_7years <- joined_7years[,c('plant_2004', 'plant_2005', 'plant_2006', 'plant_2007', 'plant_2008', 'plant_2009', 'plant_2010')]
joined_8years <- st_join(joined_7years, onset_oi_data_2011, largest = TRUE)
joined_8years['plant_2011'] <- joined_8years['plant']
joined_8years <- joined_8years[,c('plant_2004', 'plant_2005', 'plant_2006', 'plant_2007', 'plant_2008', 'plant_2009', 'plant_2010', 'plant_2011')]
joined_9years <- st_join(joined_8years, onset_oi_data_2012, largest = TRUE)
joined_9years['plant_2012'] <- joined_9years['plant']
joined_9years <- joined_9years[,c('plant_2004', 'plant_2005', 'plant_2006', 'plant_2007', 'plant_2008', 'plant_2009', 'plant_2010', 'plant_2011', 'plant_2012')]
joined_10years <- st_join(joined_9years, onset_oi_data_2013, largest = TRUE)
joined_10years['plant_2013'] <- joined_10years['plant']
joined_10years <- joined_10years[,c('plant_2004', 'plant_2005', 'plant_2006', 'plant_2007', 'plant_2008', 'plant_2009', 'plant_2010', 'plant_2011', 'plant_2012', 'plant_2013')]
joined_11years <- st_join(joined_10years, onset_oi_data_2014, largest = TRUE)
joined_11years['plant_2014'] <- joined_11years['plant']
joined_11years <- joined_11years[,c('plant_2004', 'plant_2005', 'plant_2006', 'plant_2007', 'plant_2008', 'plant_2009', 'plant_2010', 'plant_2011', 'plant_2012', 'plant_2013', 'plant_2014')]
mean_of_rows_plant <- function(row) {
data <- row[c('plant_2004', 'plant_2005', 'plant_2006', 'plant_2007', 'plant_2008', 'plant_2009', 'plant_2010', 'plant_2011', 'plant_2012', 'plant_2013', 'plant_2014')]
#st_geometry(data) <- NULL
data <- as.numeric(as.vector(data))
return(mean(data, na.rm = TRUE))
}
mean_plant <- apply(joined_11years, 1, mean_of_rows_plant)
# add mean_onset_diff to sf for mapping
joined_11years['mean_plant'] <- mean_plant
mean_plant_plot <- ggplot(joined_11years) +
geom_sf(aes(fill = mean_plant), color = NA) +
scale_fill_viridis(limits = c(60, 120)) +
ggtitle(paste('mean plant, all years', intensity, percentile)) +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black",
alpha = 0, linetype = 1) +
theme_bw()
print(mean_plant_plot)
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
onset_summarized$year <- as.numeric(levels(onset_summarized$year_factor))[onset_summarized$year_factor] #as.numeric(onset_summarized$year_factor)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year, y=onset_mean, col = onset_type)) +
geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year_factor, col = onset_type)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(20, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
onset_summarized$year <- as.numeric(levels(onset_summarized$year_factor))[onset_summarized$year_factor] #as.numeric(onset_summarized$year_factor)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year, y=onset_mean, col = onset_type)) +
#geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year_factor, col = onset_type)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(20, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
onset_summarized$year <- as.numeric(levels(onset_summarized$year_factor))[onset_summarized$year_factor] #as.numeric(onset_summarized$year_factor)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year, y=onset_mean, col = onset_type)) +
geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year, col = onset_type)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(20, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
onset_summarized$year <- as.numeric(levels(onset_summarized$year_factor))[onset_summarized$year_factor] #as.numeric(onset_summarized$year_factor)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year, y=onset_mean, col = onset_type)) +
geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year, col = onset_type),
position = position_dodge(width = 0.4)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(10, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
onset_summarized$year <- as.numeric(levels(onset_summarized$year_factor))[onset_summarized$year_factor] #as.numeric(onset_summarized$year_factor)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year, y=onset_mean, col = onset_type)) +
geom_point(aes(x=year, y=onset_mean, col = onset_type)) +
geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year, col = onset_type),
position = position_dodge(width = 0.4)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(10, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
onset_summarized$year <- as.numeric(levels(onset_summarized$year_factor))[onset_summarized$year_factor] #as.numeric(onset_summarized$year_factor)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year, y=onset_mean, col = onset_type)) +
geom_point(aes(x=year, y=onset_mean, col = onset_type)) +
geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year, col = onset_type),
position = position_dodge(width = 0.2)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(10, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
onset_summarized$year <- as.numeric(levels(onset_summarized$year_factor))[onset_summarized$year_factor] #as.numeric(onset_summarized$year_factor)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year, y=onset_mean, col = onset_type)) +
geom_point(aes(x=year, y=onset_mean, col = onset_type)) +
geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year, col = onset_type),
position = position_dodge(width = 0.2)) +
scale_x_continuous(breaks=c(2004, 2006, 2008, 2010, 2012, 2014)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(10, 80) +
theme_bw()
# import data for onset_oi
onset_oi <- 'frequency_10_persiann' #'freq_8_chirps_ATchirps5km' #'freq_10_persiann' # 'rangethres_10_15_20_30_persiann'
onset_baseline <- 'AA_25_persiann' # to compare to onset_oi in difference maps, etc 'AA_25_persiann'
onset_third <- 'rangethres_10_15_20_30_persiann' # just to plot the timeseries
# FOR onset_oi ------------------------------------------------------------------------------------------------------------------------
# read and clean the data ---------------------------------------------------------------------------------------------------------
filename_median <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_oi, '/median_onset_cell_', onset_oi , '.csv')
filename_percentile5 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_oi , '/percentile5_onset_cell_', onset_oi , '.csv')
filename_percentile25 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_oi , '/percentile25_onset_cell_', onset_oi , '.csv')
filename_percentile75 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_oi,
'/percentile75_onset_cell_', onset_oi, '.csv')
filename_percentile95 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_oi,
'/percentile95_onset_cell_', onset_oi, '.csv')
filename_shp<- paste0(first_folder,'/R-code-large-files/data_onset_', onset_oi , '/shp')
layername_shp <- paste0('median_onset_cell_SHP_', onset_oi )
median_cell_raw <- read.csv(filename_median)
# import data for onset_oi
onset_oi <- 'freq_10_persiann' #'freq_8_chirps_ATchirps5km' #'freq_10_persiann' # 'rangethres_10_15_20_30_persiann'
onset_baseline <- 'AA_25_persiann' # to compare to onset_oi in difference maps, etc 'AA_25_persiann'
onset_third <- 'rangethres_10_15_20_30_persiann' # just to plot the timeseries
# FOR onset_oi ------------------------------------------------------------------------------------------------------------------------
# read and clean the data ---------------------------------------------------------------------------------------------------------
filename_median <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_oi, '/median_onset_cell_', onset_oi , '.csv')
filename_percentile5 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_oi , '/percentile5_onset_cell_', onset_oi , '.csv')
filename_percentile25 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_oi , '/percentile25_onset_cell_', onset_oi , '.csv')
filename_percentile75 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_oi,
'/percentile75_onset_cell_', onset_oi, '.csv')
filename_percentile95 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_oi,
'/percentile95_onset_cell_', onset_oi, '.csv')
filename_shp<- paste0(first_folder,'/R-code-large-files/data_onset_', onset_oi , '/shp')
layername_shp <- paste0('median_onset_cell_SHP_', onset_oi )
median_cell_raw <- read.csv(filename_median)
percentile5_cell_raw <- read.csv(filename_percentile5)
percentile25_cell_raw <- read.csv(filename_percentile25)
percentile75_cell_raw <- read.csv(filename_percentile75)
percentile95_cell_raw <- read.csv(filename_percentile95)
cell_sf <- st_read(dsn = filename_shp, layer = layername_shp)
# CSV DATA -----------------------------------------------------------------------------------------------
# median cell
median_cell <- median_cell_raw %>% delete_cols_median_cell() %>%
rename_cols_median_cell()
median_cell$plant_stat_type <- rep('median', nrow(median_cell))
# percentiles
percentile5_cell <- percentile5_cell_raw %>% rename_cols_percentile_cell()
percentile25_cell <- percentile25_cell_raw %>% rename_cols_percentile_cell()
percentile75_cell <- percentile75_cell_raw %>% rename_cols_percentile_cell()
percentile95_cell <- percentile95_cell_raw %>% rename_cols_percentile_cell()
# SF DATA ------------------------------------------------------------------------------------------------
# get cell_ID column for median
cell_sf$cell_ID <- median_cell$cell_ID
cell_sf$cell_ID <- sapply(as.character(cell_sf$cell_ID), clean_cell_ID)
# join median, percentile data to cell_sf
# cell_sf has median information, but copy it and put in percentile info for DC and SC plant
cell_sf$plant_stat_type <- rep("median", nrow(cell_sf))
cell_sf_percentile5 <- cell_sf
cell_sf_percentile5$SC_plant <- percentile5_cell$SC_plant
cell_sf_percentile5$DC_plant <- percentile5_cell$DC_plant
cell_sf_percentile5$plant_stat_type <- rep("percentile5", nrow(cell_sf_percentile5))
cell_sf_percentile25 <- cell_sf
cell_sf_percentile25$SC_plant <- percentile25_cell$SC_plant
cell_sf_percentile25$DC_plant <- percentile25_cell$DC_plant
cell_sf_percentile25$plant_stat_type <- rep("percentile25", nrow(cell_sf_percentile25))
cell_sf_percentile75 <- cell_sf
cell_sf_percentile75$SC_plant <- percentile75_cell$SC_plant
cell_sf_percentile75$DC_plant <- percentile75_cell$DC_plant
cell_sf_percentile75$plant_stat_type <- rep("percentile75", nrow(cell_sf_percentile75))
cell_sf_percentile95 <- cell_sf
cell_sf_percentile95$SC_plant <- percentile95_cell$SC_plant
cell_sf_percentile95$DC_plant <- percentile95_cell$DC_plant
cell_sf_percentile95$plant_stat_type <- rep("percentile95", nrow(cell_sf_percentile95))
cell_sf <- rbind(cell_sf, cell_sf_percentile5, cell_sf_percentile25, cell_sf_percentile75, cell_sf_percentile95)
cell_sf_tidy <- cell_sf %>% tidy_by_intensity_plant("SC_plant", "DC_plant") %>%
dplyr::select(-c(SC_harvest, DC_harvest)) %>%
categorize_regions_cell_sf_tidy() # categorize cells into four regions
cell_sf_tidy$year_index <- cell_sf_tidy$year - 2003
cell_sf_tidy$year_factor <- as.factor(cell_sf_tidy$year)
cell_sf_tidy <- cell_sf_tidy %>%  drop_na
cell_sf_tidy$delay <- cell_sf_tidy$plant - cell_sf_tidy$onset
# calculate quantiles of onset
onset_oi_data <- cell_sf_tidy %>%
mutate(onset_quantile_allyears = ntile(onset, 10))
print('onset_oi done')
# FOR onset_baseline ------------------------------------------------------------------------------------------------------------------
# read and clean the data ---------------------------------------------------------------------------------------------------------
filename_median <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_baseline, '/median_onset_cell_', onset_baseline , '.csv')
filename_percentile5 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_baseline , '/percentile5_onset_cell_', onset_baseline , '.csv')
filename_percentile25 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_baseline , '/percentile25_onset_cell_', onset_baseline , '.csv')
filename_percentile75 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_baseline , '/percentile75_onset_cell_', onset_baseline , '.csv')
filename_percentile95 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_baseline , '/percentile95_onset_cell_', onset_baseline , '.csv')
filename_shp <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_baseline , '/shp')
layername_shp <- paste0('median_onset_cell_SHP_', onset_baseline )
median_cell_raw <- read.csv(filename_median)
percentile5_cell_raw <- read.csv(filename_percentile5)
percentile25_cell_raw <- read.csv(filename_percentile25)
percentile75_cell_raw <- read.csv(filename_percentile75)
percentile95_cell_raw <- read.csv(filename_percentile95)
cell_sf <- st_read(dsn = filename_shp, layer = layername_shp)
# CSV DATA -----------------------------------------------------------------------------------------------
# median cell
median_cell <- median_cell_raw %>% delete_cols_median_cell() %>%
rename_cols_median_cell()
median_cell$plant_stat_type <- rep('median', nrow(median_cell))
# percentiles
percentile5_cell <- percentile5_cell_raw %>% rename_cols_percentile_cell()
percentile25_cell <- percentile25_cell_raw %>% rename_cols_percentile_cell()
percentile75_cell <- percentile75_cell_raw %>% rename_cols_percentile_cell()
percentile95_cell <- percentile95_cell_raw %>% rename_cols_percentile_cell()
# SF DATA ------------------------------------------------------------------------------------------------
# get cell_ID column for median
cell_sf$cell_ID <- median_cell$cell_ID
cell_sf$cell_ID <- sapply(as.character(cell_sf$cell_ID), clean_cell_ID)
# join median, percentile data to cell_sf
# cell_sf has median information, but copy it and put in percentile info for DC and SC plant
cell_sf$plant_stat_type <- rep("median", nrow(cell_sf))
cell_sf_percentile5 <- cell_sf
cell_sf_percentile5$SC_plant <- percentile5_cell$SC_plant
cell_sf_percentile5$DC_plant <- percentile5_cell$DC_plant
cell_sf_percentile5$plant_stat_type <- rep("percentile5", nrow(cell_sf_percentile5))
cell_sf_percentile25 <- cell_sf
cell_sf_percentile25$SC_plant <- percentile25_cell$SC_plant
cell_sf_percentile25$DC_plant <- percentile25_cell$DC_plant
cell_sf_percentile25$plant_stat_type <- rep("percentile25", nrow(cell_sf_percentile25))
cell_sf_percentile75 <- cell_sf
cell_sf_percentile75$SC_plant <- percentile75_cell$SC_plant
cell_sf_percentile75$DC_plant <- percentile75_cell$DC_plant
cell_sf_percentile75$plant_stat_type <- rep("percentile75", nrow(cell_sf_percentile75))
cell_sf_percentile95 <- cell_sf
cell_sf_percentile95$SC_plant <- percentile95_cell$SC_plant
cell_sf_percentile95$DC_plant <- percentile95_cell$DC_plant
cell_sf_percentile95$plant_stat_type <- rep("percentile95", nrow(cell_sf_percentile95))
cell_sf <- rbind(cell_sf, cell_sf_percentile5, cell_sf_percentile25, cell_sf_percentile75, cell_sf_percentile95)
cell_sf_tidy <- cell_sf %>% tidy_by_intensity_plant("SC_plant", "DC_plant") %>%
dplyr::select(-c(SC_harvest, DC_harvest)) %>%
categorize_regions_cell_sf_tidy() # categorize cells into four regions
cell_sf_tidy$year_index <- cell_sf_tidy$year - 2003
cell_sf_tidy$year_factor <- as.factor(cell_sf_tidy$year)
cell_sf_tidy <- cell_sf_tidy %>%  drop_na
cell_sf_tidy$delay <- cell_sf_tidy$plant - cell_sf_tidy$onset
# calculate quantiles of onset
onset_baseline_data <- cell_sf_tidy %>%
mutate(onset_quantile_allyears = ntile(onset, 10))
print('onset_baseline done')
# FOR onset_third ------------------------------------------------------------------------------------------------------------------
# read and clean the data ---------------------------------------------------------------------------------------------------------
filename_median <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_third, '/median_onset_cell_', onset_third , '.csv')
filename_percentile5 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_third , '/percentile5_onset_cell_', onset_third , '.csv')
filename_percentile25 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_third , '/percentile25_onset_cell_', onset_third , '.csv')
filename_percentile75 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_third , '/percentile75_onset_cell_', onset_third , '.csv')
filename_percentile95 <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_third , '/percentile95_onset_cell_', onset_third , '.csv')
filename_shp <- paste0(first_folder,'/R-code-large-files/data_onset_', onset_third , '/shp')
layername_shp <- paste0('median_onset_cell_SHP_', onset_third )
median_cell_raw <- read.csv(filename_median)
percentile5_cell_raw <- read.csv(filename_percentile5)
percentile25_cell_raw <- read.csv(filename_percentile25)
percentile75_cell_raw <- read.csv(filename_percentile75)
percentile95_cell_raw <- read.csv(filename_percentile95)
cell_sf <- st_read(dsn = filename_shp, layer = layername_shp)
# CSV DATA -----------------------------------------------------------------------------------------------
# median cell
median_cell <- median_cell_raw %>% delete_cols_median_cell() %>%
rename_cols_median_cell()
median_cell$plant_stat_type <- rep('median', nrow(median_cell))
# percentiles
percentile5_cell <- percentile5_cell_raw %>% rename_cols_percentile_cell()
percentile25_cell <- percentile25_cell_raw %>% rename_cols_percentile_cell()
percentile75_cell <- percentile75_cell_raw %>% rename_cols_percentile_cell()
percentile95_cell <- percentile95_cell_raw %>% rename_cols_percentile_cell()
# SF DATA ------------------------------------------------------------------------------------------------
# get cell_ID column for median
cell_sf$cell_ID <- median_cell$cell_ID
cell_sf$cell_ID <- sapply(as.character(cell_sf$cell_ID), clean_cell_ID)
# join median, percentile data to cell_sf
# cell_sf has median information, but copy it and put in percentile info for DC and SC plant
cell_sf$plant_stat_type <- rep("median", nrow(cell_sf))
cell_sf_percentile5 <- cell_sf
cell_sf_percentile5$SC_plant <- percentile5_cell$SC_plant
cell_sf_percentile5$DC_plant <- percentile5_cell$DC_plant
cell_sf_percentile5$plant_stat_type <- rep("percentile5", nrow(cell_sf_percentile5))
cell_sf_percentile25 <- cell_sf
cell_sf_percentile25$SC_plant <- percentile25_cell$SC_plant
cell_sf_percentile25$DC_plant <- percentile25_cell$DC_plant
cell_sf_percentile25$plant_stat_type <- rep("percentile25", nrow(cell_sf_percentile25))
cell_sf_percentile75 <- cell_sf
cell_sf_percentile75$SC_plant <- percentile75_cell$SC_plant
cell_sf_percentile75$DC_plant <- percentile75_cell$DC_plant
cell_sf_percentile75$plant_stat_type <- rep("percentile75", nrow(cell_sf_percentile75))
cell_sf_percentile95 <- cell_sf
cell_sf_percentile95$SC_plant <- percentile95_cell$SC_plant
cell_sf_percentile95$DC_plant <- percentile95_cell$DC_plant
cell_sf_percentile95$plant_stat_type <- rep("percentile95", nrow(cell_sf_percentile95))
cell_sf <- rbind(cell_sf, cell_sf_percentile5, cell_sf_percentile25, cell_sf_percentile75, cell_sf_percentile95)
cell_sf_tidy <- cell_sf %>% tidy_by_intensity_plant("SC_plant", "DC_plant") %>%
dplyr::select(-c(SC_harvest, DC_harvest)) %>%
categorize_regions_cell_sf_tidy() # categorize cells into four regions
cell_sf_tidy$year_index <- cell_sf_tidy$year - 2003
cell_sf_tidy$year_factor <- as.factor(cell_sf_tidy$year)
cell_sf_tidy <- cell_sf_tidy %>%  drop_na
cell_sf_tidy$delay <- cell_sf_tidy$plant - cell_sf_tidy$onset
# calculate quantiles of onset
onset_third_data <- cell_sf_tidy %>%
mutate(onset_quantile_allyears = ntile(onset, 10))
print('onset_third done')
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_third_summarized_eachyear <- onset_third_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
st_geometry(onset_third_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_third_summarized_eachyear$onset_type <- onset_third
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear, onset_third_summarized_eachyear)
onset_summarized$year <- as.numeric(levels(onset_summarized$year_factor))[onset_summarized$year_factor] #as.numeric(onset_summarized$year_factor)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year, y=onset_mean, col = onset_type)) +
geom_point(aes(x=year, y=onset_mean, col = onset_type)) +
geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year, col = onset_type),
position = position_dodge(width = 0.2)) +
scale_x_continuous(breaks=c(2004, 2006, 2008, 2010, 2012, 2014)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(10, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_third_summarized_eachyear <- onset_third_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
st_geometry(onset_third_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_third_summarized_eachyear$onset_type <- onset_third
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear, onset_third_summarized_eachyear)
onset_summarized$year <- as.numeric(levels(onset_summarized$year_factor))[onset_summarized$year_factor] #as.numeric(onset_summarized$year_factor)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year, y=onset_mean, col = onset_type)) +
geom_point(aes(x=year, y=onset_mean, col = onset_type)) +
geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year, col = onset_type),
position = position_dodge(width = 0.2)) +
scale_x_continuous(breaks=c(2004, 2006, 2008, 2010, 2012, 2014)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(10, 90) +
theme_bw()
