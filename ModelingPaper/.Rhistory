result_name <- paste0('onset_diff_', year, '_sf')
assign(result_name, joined)
onset_diff_plot <- ggplot(joined) +
geom_sf(aes(fill = onset_diff), color = NA) +
scale_fill_gradient(low="blue", high="red") +
ggtitle(paste("Onset difference between", onset_oi, 'and', onset_baseline, year)) +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black",
alpha = 0, linetype = 1) +
theme_bw()
onset_oi_plot <- ggplot(onset_oi_year) +
geom_sf(aes(fill = onset), color = NA) +
#scale_fill_viridis() +
scale_fill_gradient(low="black", high="blue") +
#scale_fill_brewer(palette="YlOrRd") +
ggtitle(paste("Onset,", onset_oi, year)) +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black",
alpha = 0, linetype = 1) +
theme_bw()
onset_baseline_plot <- ggplot(onset_baseline_year) +
geom_sf(aes(fill = onset), color = NA) +
#scale_fill_viridis() +
scale_fill_gradient(low="black", high="blue") +
#scale_fill_brewer(palette="YlOrRd") +
ggtitle(paste("Onset,", onset_baseline, year)) +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black",
alpha = 0, linetype = 1) +
theme_bw()
print(onset_diff_plot)
print(onset_oi_plot)
print(onset_baseline_plot)
}
View(onset_diff_2004_sf)
# spatial join the onset_diff_2004_sf, etc to calculate the mean difference
joined_2years <- st_join(onset_diff_2004_sf, onset_diff_2005_sf, largest = TRUE, suffix = c('_2004', '_2005'))
View(joined_2years)
# spatial join the onset_diff_2004_sf, etc to calculate the mean difference
joined_2years <- st_join(onset_diff_2004_sf, onset_diff_2005_sf, largest = TRUE, suffix = c('_2004', '_2005'))
joined_2years <- joined_2years[c('onset_diff_2004', 'onset_diff_2005'),]
joined_3years <- st_join(joined_2years, onset_diff_2006_sf, largest = TRUE, suffix = c('', '_2006'))
joined_3years <- joined_2years[c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006'),]
View(joined_3years)
# spatial join the onset_diff_2004_sf, etc to calculate the mean difference
joined_2years <- st_join(onset_diff_2004_sf, onset_diff_2005_sf, largest = TRUE, suffix = c('_2004', '_2005'))
joined_2years <- joined_2years[,c('onset_diff_2004', 'onset_diff_2005')]
joined_3years <- st_join(joined_2years, onset_diff_2006_sf, largest = TRUE, suffix = c('', '_2006'))
joined_3years <- joined_2years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006')]
View(joined_3years)
joined_3years <- st_join(joined_2years, onset_diff_2006_sf, largest = TRUE, suffix = c('BLAH', '_2006'))
joined_3years <- joined_2years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006')]
View(joined_3years)
joined_3years <- st_join(joined_2years, onset_diff_2006_sf, largest = TRUE, suffix = c('BLAH', '_2006'))
joined_3years <- joined_3years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006')]
View(joined_3years)
View(joined_2years)
type(joined_2years)
class(joined_2years)
joined_3years <- st_join(joined_2years, onset_diff_2006_sf, largest = TRUE, suffix = c('BLAH', '_2006'))
#joined_3years <- joined_3years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006')]
joined_3years <- st_join(joined_2years, onset_diff_2006_sf, largest = TRUE)
joined_3years['onset_diff_2006'] <- joined_3years['onset_diff']
joined_3years <- joined_3years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006')]
joined_4years <- st_join(joined_3years, onset_diff_2007_sf, largest = TRUE)
joined_4years['onset_diff_2007'] <- joined_4years['onset_diff']
joined_4years <- joined_4years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007')]
View(joined_4years)
joined_5years <- st_join(joined_4years, onset_diff_2008_sf, largest = TRUE)
joined_5years['onset_diff_2008'] <- joined_5years['onset_diff']
joined_5years <- joined_5years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008')]
View(joined_5years)
joined_6years <- st_join(joined_5years, onset_diff_2009_sf, largest = TRUE)
joined_6years['onset_diff_2009'] <- joined_6years['onset_diff']
joined_6years <- joined_6years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009')]
View(joined_6years)
joined_7years <- st_join(joined_6years, onset_diff_2010_sf, largest = TRUE)
joined_7years['onset_diff_2010'] <- joined_7years['onset_diff']
joined_7years <- joined_7years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010')]
View(joined_7years)
joined_8years <- st_join(joined_7years, onset_diff_2011_sf, largest = TRUE)
joined_8years['onset_diff_2011'] <- joined_8years['onset_diff']
joined_8years <- joined_8years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011')]
joined_9years <- st_join(joined_8years, onset_diff_2012_sf, largest = TRUE)
joined_9years['onset_diff_2012'] <- joined_9years['onset_diff']
joined_9years <- joined_9years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012')]
View(joined_9years)
joined_10years <- st_join(joined_9years, onset_diff_2013_sf, largest = TRUE)
joined_10years['onset_diff_2013'] <- joined_10years['onset_diff']
joined_10years <- joined_10years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012', 'onset_diff_2013')]
joined_11years <- st_join(joined_10years, onset_diff_2014_sf, largest = TRUE)
joined_11years['onset_diff_2014'] <- joined_11years['onset_diff']
joined_11years <- joined_11years[,c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012', 'onset_diff_2013', 'onset_diff_2014')]
View(joined_11years)
mean_of_rows <- function(row) {
data <- row[, c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012', 'onset_diff_2013', 'onset_diff_2014')]
return(mean(data))
}
mean_onset_diff <- apply(joined_11years, 1, mean_of_rows)
mean_of_rows <- function(row) {
data <- row[c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012', 'onset_diff_2013', 'onset_diff_2014')]
return(mean(data))
}
mean_onset_diff <- apply(joined_11years, 1, mean_of_rows)
mean_onset_diff
mean_of_rows <- function(row) {
data <- row[c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012', 'onset_diff_2013', 'onset_diff_2014')]
return(mean(data, na.rm = TRUE))
}
mean_onset_diff <- apply(joined_11years, 1, mean_of_rows)
mean_onset_diff
joined_11years['onset_diff_2004']
joined_11years[1,]
row <- joined_11years[1,]
row[c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012', 'onset_diff_2013', 'onset_diff_2014')]
data <- row[c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012', 'onset_diff_2013', 'onset_diff_2014')]
data
mean(data)
mean(data, na.rm = TRUE)
data <- as.vector(row[c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012', 'onset_diff_2013', 'onset_diff_2014')])
data
mean(data)
st_geometry(data) <- NULL
data
mean(data)
as.numeric(data)
mean(as.numeric(data))
mean_of_rows <- function(row) {
data <- row[c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012', 'onset_diff_2013', 'onset_diff_2014')]
st_geometry(data) <- NULL
data <- as.numeric(as.vector(data))
return(mean(data, na.rm = TRUE))
}
mean_onset_diff <- apply(joined_11years, 1, mean_of_rows)
mean_of_rows <- function(row) {
data <- row[c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012', 'onset_diff_2013', 'onset_diff_2014')]
#st_geometry(data) <- NULL
data <- as.numeric(as.vector(data))
return(mean(data, na.rm = TRUE))
}
mean_onset_diff <- apply(joined_11years, 1, mean_of_rows)
mean_onset_diff
mean_of_rows <- function(row) {
data <- row[c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012', 'onset_diff_2013', 'onset_diff_2014')]
#st_geometry(data) <- NULL
data <- as.numeric(as.vector(data))
return(mean(data, na.rm = TRUE))
}
mean_onset_diff <- apply(joined_11years, 1, mean_of_rows)
# add mean_onset_diff to sf for mapping
joined_11years['mean_onset_diff'] <- mean_onset_diff
onset_diff_plot <- ggplot(joined_11years) +
geom_sf(aes(fill = mean_onset_diff), color = NA) +
scale_fill_gradient(low="blue", high="red") +
ggtitle(paste("Onset diff bet", onset_oi, 'and', onset_baseline, 'all years')) +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black",
alpha = 0, linetype = 1) +
theme_bw()
mean_of_rows <- function(row) {
data <- row[c('onset_diff_2004', 'onset_diff_2005', 'onset_diff_2006', 'onset_diff_2007', 'onset_diff_2008', 'onset_diff_2009', 'onset_diff_2010',
'onset_diff_2011', 'onset_diff_2012', 'onset_diff_2013', 'onset_diff_2014')]
#st_geometry(data) <- NULL
data <- as.numeric(as.vector(data))
return(mean(data, na.rm = TRUE))
}
mean_onset_diff <- apply(joined_11years, 1, mean_of_rows)
# add mean_onset_diff to sf for mapping
joined_11years['mean_onset_diff'] <- mean_onset_diff
mean_onset_diff_plot <- ggplot(joined_11years) +
geom_sf(aes(fill = mean_onset_diff), color = NA) +
scale_fill_gradient(low="blue", high="red") +
ggtitle(paste("Onset diff bet", onset_oi, 'and', onset_baseline, 'all years')) +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black",
alpha = 0, linetype = 1) +
theme_bw()
print(mean_onset_diff_plot)
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
# barplot
ggplot(onset_oi_summarized_eachyear) +
geom_point(aes(x=year_factor, y=onset_mean)) +
ggtitle('mean onset') +
labs(x = 'year') +
ylim(0, 15) +
theme_bw()
onset_oi_summarized_eachyear
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
# barplot
ggplot(onset_oi_summarized_eachyear) +
geom_point(aes(x=year_factor, y=onset_mean)) +
ggtitle('mean onset') +
labs(x = 'year') +
ylim(0, 15) +
theme_bw()
onset_oi_summarized_eachyear
ggplot(onset_oi_summarized_eachyear) +
geom_point(aes(x=year_factor, y=onset_mean)) +
ggtitle('mean onset') +
labs(x = 'year') +
ylim(0, 100) +
theme_bw()
rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
# barplot
ggplot(onset_summarized) +
geom_point(aes(x=year_factor, y=onset_mean, col = onset_type)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(0, 100) +
theme_bw()
ggplot(onset_summarized) +
geom_point(aes(x=year_factor, y=onset_mean, col = onset_type)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(0, 100) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year_factor, y=onset_mean, col = onset_type)) +
geom_errorbar(aes(ymin=onset_mean-onset_sd, ymax=onset_mean+onset_sd)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(20, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year_factor, y=onset_mean, col = onset_type)) +
geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(20, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year_factor, y=onset_mean, col = onset_type)) +
geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year_factor)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(20, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year_factor, y=onset_mean, col = onset_type)) +
geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year_factor, col = onset_type)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(20, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
# timeseries plot
ggplot(onset_summarized) +
geom_point(aes(x=year_factor, y=onset_mean, col = onset_type)) +
#geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year_factor, col = onset_type)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(20, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year_factor, y=onset_mean, col = onset_type)) +
#geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year_factor, col = onset_type)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(20, 80) +
theme_bw()
# error bars for spatial variability?
# group by year and onset_type, then calc median and stdev
onset_oi_summarized_eachyear <- onset_oi_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
onset_baseline_summarized_eachyear <- onset_baseline_data %>% group_by(year_factor) %>%
summarize(onset_mean = mean(onset),
onset_stdev = sd(onset)) %>%
ungroup()
st_geometry(onset_oi_summarized_eachyear) <- NULL
st_geometry(onset_baseline_summarized_eachyear) <- NULL
onset_oi_summarized_eachyear$onset_type <- onset_oi
onset_baseline_summarized_eachyear$onset_type <- onset_baseline
onset_summarized <- rbind(onset_oi_summarized_eachyear, onset_baseline_summarized_eachyear)
onset_summarized$year <- as.numeric(onset_summarized$year_factor)
# timeseries plot
ggplot(onset_summarized) +
geom_line(aes(x=year, y=onset_mean, col = onset_type)) +
#geom_errorbar(aes(ymin=onset_mean-onset_stdev, ymax=onset_mean+onset_stdev, x = year_factor, col = onset_type)) +
ggtitle('Mean onset') +
labs(x = 'year') +
ylim(20, 80) +
theme_bw()
onset_oi_data
rep('a, 4')
rep('a', 4)
data_subset <- onset_oi_data[(onset_oi_data$plant_stat_type == percentile) & (onset_oi_data$intensity == intensity), ]
data_subset_panel <- pdata.frame(data_subset, index = c("cell_ID"))
fe_model <- plm(plant ~ onset + year, data = data_subset_panel, model = "within")
percentile <- 'median'
intensity = 'SC'
data_subset <- onset_oi_data[(onset_oi_data$plant_stat_type == percentile) & (onset_oi_data$intensity == intensity), ]
data_subset_panel <- pdata.frame(data_subset, index = c("cell_ID"))
fe_model <- plm(plant ~ onset + year, data = data_subset_panel, model = "within")
str(fe_mdoel)
str(fe_model)
fe_model$coefficients
summary(fe_model)
str(summary(fe_model))
summary(fe_model)$coefficients
summary(fe_model)$coefficients['onset', 'Std. Error']
# eliminated predictors: repeat FE specification with eliminated predictors for the chosen onset definition. report onset coefficient for each intensity, percentile
elimpred_results <- data.frame(intensity = character(0), percentile = character(0),
onset_coef = numeric(0), onset_stderr = numeric(0),
model_type = character(0))
for (intensity in c("SC", "DC")) {
for (percentile in c('percentile5', 'percentile25', 'median')) {
data_subset <- onset_oi_data[(onset_oi_data$plant_stat_type == percentile) & (onset_oi_data$intensity == intensity), ]
data_subset_panel <- pdata.frame(data_subset, index = c("cell_ID"))
fe_model <- plm(plant ~ onset + year, data = data_subset_panel, model = "within")
fe_model_elimpred <- plm(plant ~ onset, data = data_subset_panel, model = "within")
ols_model <- lm(plant ~ onset + year + lat + lon + region, data = data_subset)
ols_model_elimpred <- lm(plant ~ onset, data = data_subset)
# get coefficients
fe_onset_coef <- fe_model$coefficients["onset"]
fe_elimpred_onset_coef <- fe_model_elimpred$coefficients["onset"]
ols_onset_coef <- ols_model$coefficients["onset"]
ols_elimpred_onset_coef <- ols_model_elimpred$coefficients["onset"]
fe_onset_stderr <- summary(fe_model)$coefficients['onset', 'Std. Error']
fe_elimpred_onset_stderr <- summary(fe_model_elimpred)$coefficients['onset', 'Std. Error']
ols_onset_stderr <- summary(ols_model)$coefficients['onset', 'Std. Error']
ols_elimpred_onset_stderr <- summary(ols_model_elimpred)$coefficients['onset', 'Std. Error']
results <- data.frame(intensity = rep(intensity, 4), percentile = rep(percentile, 4),
onset_coef = c(fe_onset_coef, fe_elimpred_onset_coef,
ols_onset_coef, ols_elimpred_onset_coef),
onset_stderr = c(fe_onset_stderr, fe_elimpred_onset_stderr,
ols_onset_stderr, ols_elimpred_onset_stderr),
model_type = c('fe', 'fe_elimpred', 'ols', 'ols_elimpred'))
elimpred_results <- rbind(elimpred_results, results)
}
}
print(elimpred_results)
elimpred_plot <- ggplot(elimpred_results) +
geom_point(aes(x = model_type, y = onset_coef)) +
facet_wrap(percentile ~ intensity) +
theme_bw()
print(elimpred_plot)
elimpred_plot <- ggplot(elimpred_results) +
geom_point(aes(x = model_type, y = onset_coef)) +
geom_errorbar(aes(ymin=onset_coef-onset_stderr, ymax=onset_coef+onset_stderr, x = model_type)) +
facet_wrap(intensity ~ percentile) +
theme_bw() +
theme(axis.text.x = element_text(angle = 90))
print(elimpred_plot)
# eliminated predictors: repeat FE specification with eliminated predictors for the chosen onset definition. report onset coefficient for each intensity, percentile
elimpred_results <- data.frame(intensity = character(0), percentile = character(0),
onset_coef = numeric(0), onset_stderr = numeric(0),
model_type = character(0))
for (intensity in c("SC", "DC")) {
for (percentile in c('percentile5', 'percentile25', 'median')) {
data_subset <- onset_oi_data[(onset_oi_data$plant_stat_type == percentile) & (onset_oi_data$intensity == intensity), ]
data_subset_panel <- pdata.frame(data_subset, index = c("cell_ID"))
fe_model <- plm(plant ~ onset + year, data = data_subset_panel, model = "within")
fe_model_elimpred <- plm(plant ~ onset, data = data_subset_panel, model = "within")
ols_model <- lm(plant ~ onset + year + lat + lon + region, data = data_subset)
ols_model_elimpred <- lm(plant ~ onset, data = data_subset)
# get coefficients
fe_onset_coef <- fe_model$coefficients["onset"]
fe_elimpred_onset_coef <- fe_model_elimpred$coefficients["onset"]
ols_onset_coef <- ols_model$coefficients["onset"]
ols_elimpred_onset_coef <- ols_model_elimpred$coefficients["onset"]
fe_onset_stderr <- summary(fe_model)$coefficients['onset', 'Std. Error']
fe_elimpred_onset_stderr <- summary(fe_model_elimpred)$coefficients['onset', 'Std. Error']
ols_onset_stderr <- summary(ols_model)$coefficients['onset', 'Std. Error']
ols_elimpred_onset_stderr <- summary(ols_model_elimpred)$coefficients['onset', 'Std. Error']
results <- data.frame(intensity = rep(intensity, 4), percentile = rep(percentile, 4),
onset_coef = c(fe_onset_coef, fe_elimpred_onset_coef,
ols_onset_coef, ols_elimpred_onset_coef),
onset_stderr = c(fe_onset_stderr, fe_elimpred_onset_stderr,
ols_onset_stderr, ols_elimpred_onset_stderr),
model_type = c('fe', 'fe_elimpred', 'ols', 'ols_elimpred'))
elimpred_results <- rbind(elimpred_results, results)
}
}
print(elimpred_results)
# different degrees of eliminated predictors on x axis, and onset coef on y axis
elimpred_plot <- ggplot(elimpred_results) +
geom_point(aes(x = model_type, y = onset_coef)) +
geom_errorbar(aes(ymin=onset_coef-onset_stderr, ymax=onset_coef+onset_stderr, x = model_type)) +
facet_wrap(intensity ~ percentile) +
theme_bw() +
theme(axis.text.x = element_text(angle = 90))
print(elimpred_plot)
print(elimpred_plot)
