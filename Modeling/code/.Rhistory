sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = 0.75,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_DC) <- NULL
# for plm, first set data as panel data
panel_SC <- pdata.frame(sampled_SC,index = c("cell_ID", "year_factor"))
panel_DC <- pdata.frame(sampled_DC,index = c("cell_ID", "year_factor"))
# FE
fe_result_SC <- plm(plant ~ onset + year_index, data = panel_SC, model = "within")
fe_result_DC <- plm(plant ~ onset + year_index, data = panel_DC, model = "within")
#
print(summary(fe_result_SC))
print(summary(fe_result_DC))
# save residual and observed
error_df_DC <- data.frame(residual = fe_result_DC$residuals,
observed = sampled_DC$plant)
error_df_SC <- data.frame(residual = fe_result_SC$residuals,
observed = sampled_SC$plant)
# model residual vs observed, look at slope as measure of bias
error_model_DC <- lm(residual ~ observed, data = error_df_DC)
bias_measure_DC <- error_model_DC$coefficients['observed']
error_model_SC <- lm(residual ~ observed, data = error_df_SC)
bias_measure_SC <- error_model_SC$coefficients['observed']
plot(error_df_DC$observed, error_df_DC$residual, main = 'DC')
plot(error_df_SC$observed, error_df_SC$residual, main = 'SC')
plot(sampled_DC$onset, error_df_DC$residual, main = 'DC')
plot(sampled_SC$onset, error_df_SC$residual, main = 'SC')
plot(sampled_DC$year, error_df_DC$residual, main = 'DC')
plot(sampled_SC$year, error_df_SC$residual, main = 'SC')
plot(sampled_DC$plant, sampled_DC$plant - error_df_DC$residual, main = 'DC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_SC$plant, sampled_SC$plant - error_df_SC$residual, main = 'SC, obs vs pred')
abline(a = 0, b = 1)
# extract fixed effects
fe_SC_vector <- plm::fixef(fe_result_SC)
fe_DC_vector <- plm::fixef(fe_result_DC)
# define dataframe for joining
fe_SC <- data.frame(cell_ID = names(fe_SC_vector),
fe = fe_SC_vector)
fe_DC <- data.frame(cell_ID = names(fe_DC_vector),
fe = fe_DC_vector)
# resample, keeping geometry info
sampled_SC <- get_sampled_data(full_data = cell_sf_tidy_SC, plant_stat = plant_stat_type, grid_size = 0.75,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = 0.75,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
# join
sampled_SC <- merge(sampled_SC, fe_SC, by = "cell_ID")
sampled_DC <- merge(sampled_DC, fe_DC, by = "cell_ID")
# plot fe
year <- 2014 # all years will be the same for fixed effects
sampled_SC_year <- sampled_SC[sampled_SC$year == year, ]
sampled_DC_year <- sampled_DC[sampled_DC$year == year, ]
fe_SC_map <- ggplot(sampled_SC_year) +
geom_sf(aes(fill = fe)) +
#scale_fill_viridis() +
ggtitle("Fixed effects for SC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
fe_DC_map <- ggplot(sampled_DC_year) +
geom_sf(aes(fill = fe)) +
#scale_fill_viridis() +
ggtitle("Fixed effects for DC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
print(fe_SC_map)
print(fe_DC_map)
print(onset_type)
print('bias measure, DC')
print(bias_measure_DC)
print('bias measure, SC')
print(bias_measure_SC)
library(plm) # for FE and FE
plant_stat_type = 'percentile25'
chosen_grid_size = 0.25
# sample from full data and turn into data frame
sampled_SC <- get_sampled_data(full_data = cell_sf_tidy_SC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_SC) <- NULL
sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_DC) <- NULL
# for plm, first set data as panel data
panel_SC <- pdata.frame(sampled_SC,index = c("cell_ID", "year_factor"))
panel_DC <- pdata.frame(sampled_DC,index = c("cell_ID", "year_factor"))
# FE
fe_result_SC <- plm(plant ~ onset + year_index, data = panel_SC, model = "within")
library(plm) # for FE and FE
plant_stat_type = 'percentile25'
chosen_grid_size = 0.5
# sample from full data and turn into data frame
sampled_SC <- get_sampled_data(full_data = cell_sf_tidy_SC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_SC) <- NULL
sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_DC) <- NULL
# for plm, first set data as panel data
panel_SC <- pdata.frame(sampled_SC,index = c("cell_ID", "year_factor"))
panel_DC <- pdata.frame(sampled_DC,index = c("cell_ID", "year_factor"))
# FE
fe_result_SC <- plm(plant ~ onset + year_index, data = panel_SC, model = "within")
fe_result_DC <- plm(plant ~ onset + year_index, data = panel_DC, model = "within")
#
print(summary(fe_result_SC))
print(summary(fe_result_DC))
# save residual and observed
error_df_DC <- data.frame(residual = fe_result_DC$residuals,
observed = sampled_DC$plant)
error_df_SC <- data.frame(residual = fe_result_SC$residuals,
observed = sampled_SC$plant)
# model residual vs observed, look at slope as measure of bias
error_model_DC <- lm(residual ~ observed, data = error_df_DC)
bias_measure_DC <- error_model_DC$coefficients['observed']
error_model_SC <- lm(residual ~ observed, data = error_df_SC)
bias_measure_SC <- error_model_SC$coefficients['observed']
plot(error_df_DC$observed, error_df_DC$residual, main = 'DC')
plot(error_df_SC$observed, error_df_SC$residual, main = 'SC')
plot(sampled_DC$onset, error_df_DC$residual, main = 'DC')
plot(sampled_SC$onset, error_df_SC$residual, main = 'SC')
plot(sampled_DC$year, error_df_DC$residual, main = 'DC')
plot(sampled_SC$year, error_df_SC$residual, main = 'SC')
plot(sampled_DC$plant, sampled_DC$plant - error_df_DC$residual, main = 'DC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_SC$plant, sampled_SC$plant - error_df_SC$residual, main = 'SC, obs vs pred')
abline(a = 0, b = 1)
# extract fixed effects
fe_SC_vector <- plm::fixef(fe_result_SC)
fe_DC_vector <- plm::fixef(fe_result_DC)
# define dataframe for joining
fe_SC <- data.frame(cell_ID = names(fe_SC_vector),
fe = fe_SC_vector)
fe_DC <- data.frame(cell_ID = names(fe_DC_vector),
fe = fe_DC_vector)
# resample, keeping geometry info
sampled_SC <- get_sampled_data(full_data = cell_sf_tidy_SC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
# join
sampled_SC <- merge(sampled_SC, fe_SC, by = "cell_ID")
sampled_DC <- merge(sampled_DC, fe_DC, by = "cell_ID")
# plot fe
year <- 2014 # all years will be the same for fixed effects
sampled_SC_year <- sampled_SC[sampled_SC$year == year, ]
sampled_DC_year <- sampled_DC[sampled_DC$year == year, ]
fe_SC_map <- ggplot(sampled_SC_year) +
geom_sf(aes(fill = fe)) +
#scale_fill_viridis() +
ggtitle("Fixed effects for SC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
fe_DC_map <- ggplot(sampled_DC_year) +
geom_sf(aes(fill = fe)) +
#scale_fill_viridis() +
ggtitle("Fixed effects for DC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
print(fe_SC_map)
print(fe_DC_map)
print(onset_type)
print('bias measure, DC')
print(bias_measure_DC)
print('bias measure, SC')
print(bias_measure_SC)
fe_SC_map <- ggplot(sampled_SC_year) +
geom_sf(aes(fill = fe)) +
scale_fill_viridis() +
ggtitle("Fixed effects for SC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
fe_DC_map <- ggplot(sampled_DC_year) +
geom_sf(aes(fill = fe)) +
scale_fill_viridis() +
ggtitle("Fixed effects for DC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
print(fe_SC_map)
print(fe_DC_map)
?pmodel.response
pmodel.response(fe_result_DC, sampled_DC)
library(plm) # for FE and FE
plant_stat_type = 'percentile25'
chosen_grid_size = 0.75
# sample from full data and turn into data frame
sampled_SC <- get_sampled_data(full_data = cell_sf_tidy_SC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_SC) <- NULL
sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_DC) <- NULL
# for plm, first set data as panel data
panel_SC <- pdata.frame(sampled_SC,index = c("cell_ID", "year_factor"))
panel_DC <- pdata.frame(sampled_DC,index = c("cell_ID", "year_factor"))
# FE
fe_result_SC <- plm(plant ~ onset + year_index, data = panel_SC, model = "within")
fe_result_DC <- plm(plant ~ onset + year_index, data = panel_DC, model = "within")
#
print(summary(fe_result_SC))
print(summary(fe_result_DC))
# save residual and observed
error_df_DC <- data.frame(residual = fe_result_DC$residuals,
observed = sampled_DC$plant)
error_df_SC <- data.frame(residual = fe_result_SC$residuals,
observed = sampled_SC$plant)
# model residual vs observed, look at slope as measure of bias
error_model_DC <- lm(residual ~ observed, data = error_df_DC)
bias_measure_DC <- error_model_DC$coefficients['observed']
error_model_SC <- lm(residual ~ observed, data = error_df_SC)
bias_measure_SC <- error_model_SC$coefficients['observed']
plot(error_df_DC$observed, error_df_DC$residual, main = 'DC')
plot(error_df_SC$observed, error_df_SC$residual, main = 'SC')
plot(sampled_DC$onset, error_df_DC$residual, main = 'DC')
plot(sampled_SC$onset, error_df_SC$residual, main = 'SC')
plot(sampled_DC$year, error_df_DC$residual, main = 'DC')
plot(sampled_SC$year, error_df_SC$residual, main = 'SC')
plot(sampled_DC$plant, sampled_DC$plant - error_df_DC$residual, main = 'DC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_SC$plant, sampled_SC$plant - error_df_SC$residual, main = 'SC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_DC$plant - mean(sampled_DC$plant), pmodel.response(fe_result_DC, sampled_DC), main = 'DC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_SC$plant - mean(sampled_SC$plant), pmodel.response(fe_result_SC, sampled_SC), main = 'SC, obs vs pred')
abline(a = 0, b = 1)
# extract fixed effects
fe_SC_vector <- plm::fixef(fe_result_SC)
fe_DC_vector <- plm::fixef(fe_result_DC)
# define dataframe for joining
fe_SC <- data.frame(cell_ID = names(fe_SC_vector),
fe = fe_SC_vector)
fe_DC <- data.frame(cell_ID = names(fe_DC_vector),
fe = fe_DC_vector)
# resample, keeping geometry info
sampled_SC <- get_sampled_data(full_data = cell_sf_tidy_SC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
# join
sampled_SC <- merge(sampled_SC, fe_SC, by = "cell_ID")
sampled_DC <- merge(sampled_DC, fe_DC, by = "cell_ID")
# plot fe
year <- 2014 # all years will be the same for fixed effects
sampled_SC_year <- sampled_SC[sampled_SC$year == year, ]
sampled_DC_year <- sampled_DC[sampled_DC$year == year, ]
fe_SC_map <- ggplot(sampled_SC_year) +
geom_sf(aes(fill = fe)) +
scale_fill_viridis() +
ggtitle("Fixed effects for SC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
fe_DC_map <- ggplot(sampled_DC_year) +
geom_sf(aes(fill = fe)) +
scale_fill_viridis() +
ggtitle("Fixed effects for DC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
print(fe_SC_map)
print(fe_DC_map)
print(onset_type)
print('bias measure, DC')
print(bias_measure_DC)
print('bias measure, SC')
print(bias_measure_SC)
library(plm) # for FE and FE
plant_stat_type = 'percentile25'
chosen_grid_size = 0.75
# sample from full data and turn into data frame
sampled_SC <- get_sampled_data(full_data = cell_sf_tidy_SC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_SC) <- NULL
sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_DC) <- NULL
# for plm, first set data as panel data
panel_SC <- pdata.frame(sampled_SC,index = c("cell_ID", "year_factor"))
panel_DC <- pdata.frame(sampled_DC,index = c("cell_ID", "year_factor"))
# FE
fe_result_SC <- plm(plant ~ onset + year_index, data = panel_SC, model = "within")
fe_result_DC <- plm(plant ~ onset + year_index, data = panel_DC, model = "within")
#
print(summary(fe_result_SC))
print(summary(fe_result_DC))
# save residual and observed
error_df_DC <- data.frame(residual = fe_result_DC$residuals,
observed = sampled_DC$plant)
error_df_SC <- data.frame(residual = fe_result_SC$residuals,
observed = sampled_SC$plant)
# model residual vs observed, look at slope as measure of bias
error_model_DC <- lm(residual ~ observed, data = error_df_DC)
bias_measure_DC <- error_model_DC$coefficients['observed']
error_model_SC <- lm(residual ~ observed, data = error_df_SC)
bias_measure_SC <- error_model_SC$coefficients['observed']
plot(error_df_DC$observed, error_df_DC$residual, main = 'DC')
plot(error_df_SC$observed, error_df_SC$residual, main = 'SC')
plot(sampled_DC$onset, error_df_DC$residual, main = 'DC')
plot(sampled_SC$onset, error_df_SC$residual, main = 'SC')
plot(sampled_DC$year, error_df_DC$residual, main = 'DC')
plot(sampled_SC$year, error_df_SC$residual, main = 'SC')
plot(sampled_DC$plant, sampled_DC$plant - error_df_DC$residual, main = 'DC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_SC$plant, sampled_SC$plant - error_df_SC$residual, main = 'SC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_DC$plant - mean(sampled_DC$plant), pmodel.response(fe_result_DC, sampled_DC), main = 'DC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_SC$plant - mean(sampled_SC$plant), pmodel.response(fe_result_SC, sampled_SC), main = 'SC, obs vs pred')
abline(a = 0, b = 1)
# extract fixed effects
fe_SC_vector <- plm::fixef(fe_result_SC)
fe_DC_vector <- plm::fixef(fe_result_DC)
# define dataframe for joining
fe_SC <- data.frame(cell_ID = names(fe_SC_vector),
fe = fe_SC_vector)
fe_DC <- data.frame(cell_ID = names(fe_DC_vector),
fe = fe_DC_vector)
# resample, keeping geometry info
sampled_SC <- get_sampled_data(full_data = cell_sf_tidy_SC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
# join
sampled_SC <- merge(sampled_SC, fe_SC, by = "cell_ID")
sampled_DC <- merge(sampled_DC, fe_DC, by = "cell_ID")
# plot fe
year <- 2014 # all years will be the same for fixed effects
sampled_SC_year <- sampled_SC[sampled_SC$year == year, ]
sampled_DC_year <- sampled_DC[sampled_DC$year == year, ]
fe_SC_map <- ggplot(sampled_SC_year) +
geom_sf(aes(fill = fe)) +
scale_fill_viridis() +
ggtitle("Fixed effects for SC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
fe_DC_map <- ggplot(sampled_DC_year) +
geom_sf(aes(fill = fe)) +
scale_fill_viridis() +
ggtitle("Fixed effects for DC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
print(fe_SC_map)
print(fe_DC_map)
print(onset_type)
print('bias measure, DC')
print(bias_measure_DC)
print('bias measure, SC')
print(bias_measure_SC)
library(plm) # for FE and FE
plant_stat_type = 'percentile25'
chosen_grid_size = 0.75
# sample from full data and turn into data frame
sampled_SC <- get_sampled_data(full_data = cell_sf_tidy_SC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_SC) <- NULL
sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_DC) <- NULL
# for plm, first set data as panel data
panel_SC <- pdata.frame(sampled_SC,index = c("cell_ID"))
panel_DC <- pdata.frame(sampled_DC,index = c("cell_ID"))
# FE
fe_result_SC <- plm(plant ~ onset + year_index, data = panel_SC, model = "within")
fe_result_DC <- plm(plant ~ onset + year_index, data = panel_DC, model = "within")
#
print(summary(fe_result_SC))
print(summary(fe_result_DC))
# save residual and observed
error_df_DC <- data.frame(residual = fe_result_DC$residuals,
observed = sampled_DC$plant)
error_df_SC <- data.frame(residual = fe_result_SC$residuals,
observed = sampled_SC$plant)
# model residual vs observed, look at slope as measure of bias
error_model_DC <- lm(residual ~ observed, data = error_df_DC)
bias_measure_DC <- error_model_DC$coefficients['observed']
error_model_SC <- lm(residual ~ observed, data = error_df_SC)
bias_measure_SC <- error_model_SC$coefficients['observed']
plot(error_df_DC$observed, error_df_DC$residual, main = 'DC')
plot(error_df_SC$observed, error_df_SC$residual, main = 'SC')
plot(sampled_DC$onset, error_df_DC$residual, main = 'DC')
plot(sampled_SC$onset, error_df_SC$residual, main = 'SC')
plot(sampled_DC$year, error_df_DC$residual, main = 'DC')
plot(sampled_SC$year, error_df_SC$residual, main = 'SC')
plot(sampled_DC$plant, sampled_DC$plant - error_df_DC$residual, main = 'DC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_SC$plant, sampled_SC$plant - error_df_SC$residual, main = 'SC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_DC$plant - mean(sampled_DC$plant), pmodel.response(fe_result_DC, sampled_DC), main = 'DC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_SC$plant - mean(sampled_SC$plant), pmodel.response(fe_result_SC, sampled_SC), main = 'SC, obs vs pred')
abline(a = 0, b = 1)
# extract fixed effects
fe_SC_vector <- plm::fixef(fe_result_SC)
fe_DC_vector <- plm::fixef(fe_result_DC)
# define dataframe for joining
fe_SC <- data.frame(cell_ID = names(fe_SC_vector),
fe = fe_SC_vector)
fe_DC <- data.frame(cell_ID = names(fe_DC_vector),
fe = fe_DC_vector)
# resample, keeping geometry info
sampled_SC <- get_sampled_data(full_data = cell_sf_tidy_SC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
# join
sampled_SC <- merge(sampled_SC, fe_SC, by = "cell_ID")
sampled_DC <- merge(sampled_DC, fe_DC, by = "cell_ID")
# plot fe
year <- 2014 # all years will be the same for fixed effects
sampled_SC_year <- sampled_SC[sampled_SC$year == year, ]
sampled_DC_year <- sampled_DC[sampled_DC$year == year, ]
fe_SC_map <- ggplot(sampled_SC_year) +
geom_sf(aes(fill = fe)) +
scale_fill_viridis() +
ggtitle("Fixed effects for SC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
fe_DC_map <- ggplot(sampled_DC_year) +
geom_sf(aes(fill = fe)) +
scale_fill_viridis() +
ggtitle("Fixed effects for DC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
print(fe_SC_map)
print(fe_DC_map)
print(onset_type)
print('bias measure, DC')
print(bias_measure_DC)
print('bias measure, SC')
print(bias_measure_SC)
library(plm) # for FE and FE
plant_stat_type = 'percentile25'
chosen_grid_size = 0.75
# sample from full data and turn into data frame
sampled_SC <- get_sampled_data(full_data = cell_sf_tidy_SC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_SC) <- NULL
sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
st_geometry(sampled_DC) <- NULL
# for plm, first set data as panel data
panel_SC <- pdata.frame(sampled_SC,index = c("cell_ID"))
panel_DC <- pdata.frame(sampled_DC,index = c("cell_ID"))
# FE
fe_result_SC <- plm(plant ~ onset + year_factor, data = panel_SC, model = "within")
fe_result_DC <- plm(plant ~ onset + year_factor, data = panel_DC, model = "within")
#
print(summary(fe_result_SC))
print(summary(fe_result_DC))
# save residual and observed
error_df_DC <- data.frame(residual = fe_result_DC$residuals,
observed = sampled_DC$plant)
error_df_SC <- data.frame(residual = fe_result_SC$residuals,
observed = sampled_SC$plant)
# model residual vs observed, look at slope as measure of bias
error_model_DC <- lm(residual ~ observed, data = error_df_DC)
bias_measure_DC <- error_model_DC$coefficients['observed']
error_model_SC <- lm(residual ~ observed, data = error_df_SC)
bias_measure_SC <- error_model_SC$coefficients['observed']
plot(error_df_DC$observed, error_df_DC$residual, main = 'DC')
plot(error_df_SC$observed, error_df_SC$residual, main = 'SC')
plot(sampled_DC$onset, error_df_DC$residual, main = 'DC')
plot(sampled_SC$onset, error_df_SC$residual, main = 'SC')
plot(sampled_DC$year, error_df_DC$residual, main = 'DC')
plot(sampled_SC$year, error_df_SC$residual, main = 'SC')
plot(sampled_DC$plant, sampled_DC$plant - error_df_DC$residual, main = 'DC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_SC$plant, sampled_SC$plant - error_df_SC$residual, main = 'SC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_DC$plant - mean(sampled_DC$plant), pmodel.response(fe_result_DC, sampled_DC), main = 'DC, obs vs pred')
abline(a = 0, b = 1)
plot(sampled_SC$plant - mean(sampled_SC$plant), pmodel.response(fe_result_SC, sampled_SC), main = 'SC, obs vs pred')
abline(a = 0, b = 1)
# extract fixed effects
fe_SC_vector <- plm::fixef(fe_result_SC)
fe_DC_vector <- plm::fixef(fe_result_DC)
# define dataframe for joining
fe_SC <- data.frame(cell_ID = names(fe_SC_vector),
fe = fe_SC_vector)
fe_DC <- data.frame(cell_ID = names(fe_DC_vector),
fe = fe_DC_vector)
# resample, keeping geometry info
sampled_SC <- get_sampled_data(full_data = cell_sf_tidy_SC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
sampled_DC <- get_sampled_data(full_data = cell_sf_tidy_DC, plant_stat = plant_stat_type, grid_size = chosen_grid_size,
lat_offset = 0, lon_offset = 0, agg_scheme = FALSE, plot_samples = FALSE, year_oi = 2012)
# join
sampled_SC <- merge(sampled_SC, fe_SC, by = "cell_ID")
sampled_DC <- merge(sampled_DC, fe_DC, by = "cell_ID")
# plot fe
year <- 2014 # all years will be the same for fixed effects
sampled_SC_year <- sampled_SC[sampled_SC$year == year, ]
sampled_DC_year <- sampled_DC[sampled_DC$year == year, ]
fe_SC_map <- ggplot(sampled_SC_year) +
geom_sf(aes(fill = fe)) +
scale_fill_viridis() +
ggtitle("Fixed effects for SC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
fe_DC_map <- ggplot(sampled_DC_year) +
geom_sf(aes(fill = fe)) +
scale_fill_viridis() +
ggtitle("Fixed effects for DC") +
geom_polygon(data = MT_outline, aes(x = long, y = lat), color = "black", alpha = 0, linetype = 1) +
theme_bw()
print(fe_SC_map)
print(fe_DC_map)
print(onset_type)
print('bias measure, DC')
print(bias_measure_DC)
print('bias measure, SC')
print(bias_measure_SC)
os_system <- 'mac' # mac for laptop or windows for desktop
library(ggplot2)
install.packages('devtools')
sessionInfo()
